/*! For license information please see frontend.NOiSNbPTy.js.LICENSE.txt */
(()=>{"use strict";var e,t={952:(e,t,i)=>{i.d(t,{Z:()=>n}),e=i.hmd(e);const r=new class{constructor(e={}){this.options={useETag:!0,useCache:!0,cookieName:"pr_vt_c",useIndexedDB:!0,cookieExpires:365,indexedDBName:"pr_vt_db",indexedDBVersion:1,localStorageName:"pr_vt_ls",useFingerprinting:!0,indexedDBStoreName:"pr_vt_idb",sessionStorageName:"pr_vt_ssn",...e},this.db=null,this.storages=this.detectAvailableStorages(),this.visitorID=null,this.fingerprint=null}detectAvailableStorages(){const e={};try{document.cookie="pr-test=1; max-age=60",e.cookie=-1!==document.cookie.indexOf("pr-test="),document.cookie="pr-test=1; max-age=0"}catch(t){e.cookie=!1}try{localStorage.setItem("test","1"),e.localStorage="1"===localStorage.getItem("test"),localStorage.removeItem("test")}catch(t){e.localStorage=!1}try{sessionStorage.setItem("test","1"),e.sessionStorage="1"===sessionStorage.getItem("test"),sessionStorage.removeItem("test")}catch(t){e.sessionStorage=!1}return e.indexedDB="indexedDB"in window,e}async generateFingerprint(){const e=[];e.push(navigator.userAgent),e.push(navigator.language),e.push(navigator.languages?navigator.languages.join(","):""),e.push(navigator.platform),e.push(screen.width+"x"+screen.height),e.push(screen.colorDepth+"bit"),e.push("timezone:"+Intl.DateTimeFormat().resolvedOptions().timeZone),e.push("canvas:"+this.getCanvasFingerprint()),e.push("webgl:"+this.getWebGLFingerprint()),e.push("audio:"+this.getAudioFingerprint()),e.push("fonts:"+await this.getFontsFingerprint()),e.push("hardwareConcurrency:"+(navigator.hardwareConcurrency||"unknown")),e.push("deviceMemory:"+(navigator.deviceMemory||"unknown")),e.push("maxTouchPoints:"+(navigator.maxTouchPoints||"unknown"));const t=e.join("|");return await this.hashString(t)}getCanvasFingerprint(){try{const e=document.createElement("canvas"),t=e.getContext("2d");return e.width=200,e.height=50,t.textBaseline="top",t.font="14px Arial",t.fillStyle="#f60",t.fillRect(125,1,62,20),t.fillStyle="#069",t.fillText("Fingerprint",2,15),t.fillStyle="rgba(102, 204, 0, 0.7)",t.fillText("Fingerprint",4,17),e.toDataURL().substring(22,50)}catch(e){return"error"}}getWebGLFingerprint(){try{const e=document.createElement("canvas"),t=e.getContext("webgl")||e.getContext("experimental-webgl");if(!t)return"no-webgl";const i=t.getExtension("WEBGL_debug_renderer_info"),r=t.getParameter(i.UNMASKED_VENDOR_WEBGL);return(r+"|"+t.getParameter(i.UNMASKED_RENDERER_WEBGL)).substring(0,50)}catch(e){return"error"}}getAudioFingerprint(){try{const e=window.OfflineAudioContext||window.webkitOfflineAudioContext;if(!e)return"no-audio";const t=new e(1,44100,44100),i=t.createOscillator(),r=t.createDynamicsCompressor();return i.frequency.value=1e4,i.connect(r),r.connect(t.destination),i.start(0),"audio-supported"}catch(e){return"error"}}async getFontsFingerprint(){const e=["Arial","Arial Black","Times New Roman","Courier New","Verdana","Georgia"],t=[];for(const i of e)await this.isFontAvailable(i)&&t.push(i);return t.join(",")}isFontAvailable(e){return new Promise((t=>{const i="mmmmmmmmmmlli",r=document.createElement("canvas").getContext("2d"),n=["sans-serif","serif"];r.font="72px "+n[0];const s=r.measureText(i).width;r.font="72px "+e+","+n[0];t(s!==r.measureText(i).width)}))}async hashString(e){try{const t=(new TextEncoder).encode(e),i=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(i)).map((e=>e.toString(16).padStart(2,"0"))).join("").substring(0,16)}catch(t){let i=0;for(let t=0;t<e.length;t++){i=(i<<5)-i+e.charCodeAt(t),i&=i}return Math.abs(i).toString(16)}}async initialize(){return this.visitorID||(this.options.useIndexedDB&&await this.initIndexedDB(),this.options.useFingerprinting&&(this.fingerprint=await this.generateFingerprint()),this.visitorID=await this.findUserByIdentity(),this.visitorID||(this.visitorID=this.generateID(),await this.persistIdentity(this.visitorID)),await this.updateVisitData()),this.visitorID}async findUserByIdentity(){if(this.options.useFingerprinting&&this.options.useIndexedDB){const e=await this.findByFingerprintInIndexedDB(this.fingerprint);if(e&&e.id)return e.id}const e=this.getOrderedStorages();for(const t of e)if(this.storages[t])try{const e=await this.readFromStorage(t);if(e&&e.id)return e.id}catch(e){console.warn(`Failed to read from ${t}:`,e)}return null}async persistIdentity(e){const t={id:e,fingerprint:this.fingerprint,created:(new Date).toISOString(),userAgent:navigator.userAgent,platform:navigator.platform,languages:navigator.languages||[navigator.language]};await this.writeToAllStorages(t)}async updateVisitData(){const e=await this.getVisitorData()||{id:this.visitorID,fingerprint:this.fingerprint,firstVisit:(new Date).toISOString(),visitCount:0,sessions:[],identities:[]};if(e.lastVisit=(new Date).toISOString(),e.visitCount=(e.visitCount||0)+1,e.userAgent=navigator.userAgent,e.platform=navigator.platform,e.sessions=e.sessions||[],e.sessions.push({start:(new Date).toISOString(),userAgent:navigator.userAgent,language:navigator.language,platform:navigator.platform,fingerprint:this.fingerprint}),e.sessions.length>20&&(e.sessions=e.sessions.slice(-20)),this.fingerprint&&this.options.useFingerprinting){e.identities=e.identities||[];e.identities.find((e=>e.fingerprint===this.fingerprint))||e.identities.push({fingerprint:this.fingerprint,firstSeen:(new Date).toISOString(),userAgent:navigator.userAgent})}return await this.writeToAllStorages(e),e}async readFromStorage(e){try{switch(e){case"indexedDB":return await this.readFromIndexedDB(this.visitorID||"default");case"localStorage":const e=localStorage.getItem(this.options.localStorageName);return e?JSON.parse(e):null;case"sessionStorage":const t=sessionStorage.getItem(this.options.sessionStorageName);return t?JSON.parse(t):null;case"cookie":const i=PRHelper.getServer().getCookie(this.options.cookieName);return i?JSON.parse(i):null;default:return null}}catch(e){return null}}async writeToStorage(e,t){try{switch(e){case"indexedDB":return await this.saveToIndexedDB(t);case"localStorage":return localStorage.setItem(this.options.localStorageName,JSON.stringify(t)),!0;case"sessionStorage":return sessionStorage.setItem(this.options.sessionStorageName,JSON.stringify(t)),!0;case"cookie":return this.setCookie(this.options.cookieName,JSON.stringify(t),this.options.cookieExpires),!0;default:return!1}}catch(e){return!1}}async writeToAllStorages(e){const t=[],i=this.getOrderedStorages();for(const r of i)this.storages[r]&&t.push(this.writeToStorage(r,e));await Promise.allSettled(t)}setCookie(e,t,i){PRHelper.getServer().setCookie(e,t,24*i*60*60,`.${PRHelper.getServer().getBaseDomain()}`)}async initIndexedDB(){return!(!this.storages.indexedDB||!this.options.useIndexedDB)&&new Promise(((e,t)=>{const i=indexedDB.open(this.options.indexedDBName,this.options.indexedDBVersion);i.onerror=()=>{e(!1)},i.onsuccess=t=>{this.db=t.target.result,e(!0)},i.onupgradeneeded=e=>{const t=e.target.result;if(!t.objectStoreNames.contains(this.options.indexedDBStoreName)){const e=t.createObjectStore(this.options.indexedDBStoreName,{keyPath:"id"});e.createIndex("fingerprint","fingerprint",{unique:!1}),e.createIndex("created","created",{unique:!1})}}}))}async saveToIndexedDB(e){if(!this.db){if(!await this.initIndexedDB())return!1}return new Promise((t=>{const i=this.db.transaction([this.options.indexedDBStoreName],"readwrite").objectStore(this.options.indexedDBStoreName).put(e);i.onsuccess=()=>{t(!0)},i.onerror=()=>{t(!1)}}))}async readFromIndexedDB(e){if(!this.db){if(!await this.initIndexedDB())return null}return new Promise((t=>{const i=this.db.transaction([this.options.indexedDBStoreName],"readonly").objectStore(this.options.indexedDBStoreName).get(e);i.onsuccess=()=>{t(i.result||null)},i.onerror=()=>{console.warn("Failed to read from IndexedDB"),t(null)}}))}async findByFingerprintInIndexedDB(e){if(!this.db){if(!await this.initIndexedDB())return null}return new Promise((t=>{const i=this.db.transaction([this.options.indexedDBStoreName],"readonly").objectStore(this.options.indexedDBStoreName).index("fingerprint").get(e);i.onsuccess=()=>{t(i.result||null)},i.onerror=()=>{t(null)}}))}async getAllFromIndexedDB(){if(!this.db){if(!await this.initIndexedDB())return[]}return new Promise((e=>{const t=this.db.transaction([this.options.indexedDBStoreName],"readonly").objectStore(this.options.indexedDBStoreName).getAll();t.onsuccess=()=>{e(t.result||[])},t.onerror=()=>{e([])}}))}generateID(){return PRHelper.getTool().generateUUID()}async getVisitorInfo(){this.visitorID||await this.initialize();return await this.getVisitorData()||{id:this.visitorID,fingerprint:this.fingerprint}}getVisitorID(){return this.visitorID}async getVisitorData(){const e=this.getOrderedStorages();for(const t of e)if(this.storages[t]){const e=await this.readFromStorage(t);if(e)return e}return null}getOrderedStorages(){return["indexedDB","localStorage","sessionStorage","cookie"]}getCurrentFingerprint(){return this.fingerprint}async trackEvent(e,t={}){const i=await this.getVisitorData();i&&(i.events=i.events||[],i.events.push({name:e,data:t,timestamp:(new Date).toISOString(),fingerprint:this.fingerprint}),i.events.length>100&&(i.events=i.events.slice(-100)),await this.writeToAllStorages(i))}async clearData(){const e=[];this.storages.indexedDB&&this.db&&e.push(new Promise((e=>{const t=this.db.transaction([this.options.indexedDBStoreName],"readwrite").objectStore(this.options.indexedDBStoreName).clear();t.onsuccess=()=>e(),t.onerror=()=>e()}))),this.storages.localStorage&&localStorage.removeItem(this.options.localStorageName),this.storages.sessionStorage&&sessionStorage.removeItem(this.options.sessionStorageName),this.storages.cookie&&this.setCookie(this.options.cookieName,"",-1),await Promise.allSettled(e),this.visitorID=null,this.fingerprint=null}getActiveStorages(){return Object.keys(this.storages).filter((e=>this.storages[e]))}};window.visitorTracker=r,e.exports&&(e.exports={VisitorTracker,visitorTracker:r});const n=r}},i={};function r(e){var n=i[e];if(void 0!==n)return n.exports;var s=i[e]={id:e,loaded:!1,exports:{}};return t[e](s,s.exports,r),s.loaded=!0,s.exports}r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e=r(952),function(){const t=PRHelper.getHook(),i=PRHelper.getStorage();t.on("DOMContentLoaded",(()=>{e.Z.initialize().then((async()=>{const t=await e.Z.getVisitorInfo();i.set("pr_visitor_id",t.id),PRHelper.getHook().trigger("pr_visitor_tracker_visitor_info",t),PRHelper.getHook().doAction("pr_visitor_tracker_visitor_info",t);const r={screen:`${screen.width}x${screen.height}`,visitor:t,userAgent:navigator.userAgent,timestamp:Date.now()},n="vt_last_seen_update",s=i.get(n);(!s||r.timestamp-s>12e5)&&PRHelper.getRequest().restPost("core/vt/create").onSuccess((()=>{i.set(n,r.timestamp)})).addNonce().send(r)}))}))}()})();